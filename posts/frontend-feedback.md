僕は趣味でWebフロントエンドの開発を行っています。
始めたての頃は、とにかく動くものが作れることに達成感がありました。
フォームに文字を入力してボタンをクリックするとデータが保存されたり、アイテムをクリックすると詳細画面に遷移したりと、それだけで楽しめました。
しかし様々なものを作っていると、それだけでは満足できずに品質を意識するようになってきます。

> [!info]
> TODO

この投稿は、処理の状況を伝えることが品質向上において重要なのではないかという考えをまとめたものです。

## Webフロントエンドの品質

品質の向上のためには、**品質特性**(品質を評価する基準)を考える必要があります。

まず、品質をユーザーから見える**外部品質**とユーザーから見えない**内部品質**に分けてみます。
外部品質はソフトウェアの価値を提供するために必要であり、内部品質はソフトウェアの価値を維持するために必要です。
外部品質特性として、仕様通りに動作する・バグが少ない・高速に動作する・使いやすいなどがあります。
内部品質特性としては、コードが変更しやすい・コードが読みやすいなどがあります。

ここでは品質特性のうち「使いやすい」の側面の一つである、「**ユーザーがストレスなく使えるか**」について見ていきます。
この「使いやすい」という特性は**ユーザビリティ**と呼ばれ、その評価基準として満足度が存在します。
ユーザーが使いやすいかどうかを表しているのは満足度のことであり、使っていて無駄なストレスがかかる場合には満足度は下がると考えています。

> [!info]
ユーザビリティを評価するときには、ソフトウェアの品質以外に利用の目的や利用の状況も必要になってくるため、厳密にはソフトウェアの品質特性として含められないかもしれません。
ここでは単純にするため、ソフトウェアの品質特性としてユーザビリティを含めていますが、ソフトウェアの品質だけがユーザビリティを左右するわけではないことを意識する必要はあります。

Webフロントエンドは、「ユーザーがストレスなく使えるか」に大きな影響を与えます。
バックエンドはユーザーと直接対話しないため、ユーザーのストレスを直接的に軽減できる要素は限られます。
一方で、フロントエンドはUIを通じてユーザと直接対話するため、ユーザーのストレスを軽減できる様々な可能性を秘めています。
例えば、バックエンドのパフォーマンスが低くても、フロントエンドの工夫次第ではユーザーのストレスを緩和できる可能性が高いです。

ユーザーへのストレス要因は多岐にわたりますが、ここでは開発時に見落とされがちな「**処理状況の不透明さ**」について考えていきます。
処理状況の不透明さとは、処理が動いているのか止まっているのか、成功か失敗か、失敗なのかデータが無いのかなどの区別がつかないことです。
これらは開発中に意識しないと気づきにくいです。例えば開発環境は高速なため処理途中の時間はあまり存在しませんし、
開発時には意識しないと遭遇しないエラーもあります。

処理状況が不透明な場合、ユーザーは何が起きているかを把握するのが面倒なためにストレスを感じやすいと思います。
例えばボタンをクリックしても画面に何も変化がない場合、ユーザーに「処理が行われているのか？」という不必要な思考を強いることになります。
また、処理が完了しても画面に何も変化がない場合、ユーザーは「処理が完了したのか？」という不安を抱えながら次の行動を取る必要が出てきます。
そのため、処理状況の不透明さはユーザーの負担を大きくし、ストレスの要因となります。

ここでは、Webアプリの処理を**Query**(データの取得)と**Mutation**(データの更新)に分類します。
QueryやMutationは同期的に行われる場合もあれば、非同期的に行われる場合もあります。
例えばメモリの操作のように比較的短時間で完了する処理は同期的に行われることが多いです。
一方で、ネットワークI/Oのように完了までに時間がかかる処理は非同期的に行われることが多いです。

Webアプリの処理状況が不透明というのは、QueryやMutationの状況が不透明ということになります。
データが取得中・更新中なのか、データの取得や更新は成功しているのか、データの取得が失敗しているのか・取得したデータが空だったのかなどの区別がつかないということです。

処理状況の不透明さを解消するためには、ユーザーに適切な**フィードバック**をUIを通じて提供する必要があります。
これはユーザーに処理の状況を伝えるということであり、ユーザーがシステムの状況を推測なしに理解し、不安なく操作を進めるために必要です。

フィードバックは、ユーザーに伝えるべき処理の状態に応じて、適切なUIを選択する必要があります。
ここでは処理の状態を以下の4つに分類し、それぞれのUIについて見ていきます。

- **処理中** (Pending)
- **失敗** (Error)
- **成功** (Success)
- **該当データなし** (Empty)

### 処理中 (Pending)

処理中とは、Query/Mutationが実行中であることを表す状態です。
例えばサーバーからデータを取得するためにネットワーク通信を行っている最中や、サーバーにデータを送信して更新処理を行っている最中などが該当します。

処理中であることを伝えるUIとしては**プログレスインジケーター**が使われることが多いです。
プログレスインジケーターはどれだけ時間を要するかを明確に伝える**確定タイプ**と、伝えない**未確定タイプ**に分類できます。
プログレスインジケーターの中には、ライン型のリニアインジケーターや円型のサーキュラーインジケーターなどがあります。

Queryの処理中を伝えるときには、読み込み後にデータを表示する領域にインジケーターを配置することが一般的です。
例えば複数のデータを読み込んでリスト表示する場合、リストを表示する領域にインジケーターを配置するUIがよく見られます。
また、読み込まれるデータのUIと似せた形のスケルトンスクリーンと呼ばれるインジケーターが使われることもあります。

Query後にデータを表示する場所がまだ描画されていない場合には、画面上部にリニアインジケーターが配置されることがあります。
例えばリンクをクリックしてQuery後にナビゲーションする場合には、データが表示される領域がまだ描画されていないため、このパターンが使われます。

Mutationの処理中を伝えるときには、更新のきっかけとなるUIにインジケータを配置することが一般的です。
例えばフォームに必要な情報を入力して作成ボタンのクリックでデータを作成する場合、作成ボタンの中にインジケーターを配置するUIがよく見られます。
また、処理中にボタンを無効にして、ユーザーが誤って何度もクリックできないように制御するケースも一般的です。

Mutationの処理中を伝える他のパターンとしては、トースト通知もあります。
そもそも更新のきっかけとなるUIが存在していない場合、処理中を伝えるメッセージをトーストで表示させておくという方法も考えられます。
ただ、トーストは使いすぎると煩わしさを感じさせてしまうため、必要な場面でのみ使うのが良いと思います。

Query/Mutationが処理中であることを伝えるUIは開発時に見落としやすいため、特に意識する必要があります。
これらのUIは処理時間が長い場合に表示したくなるものですが、
開発環境では非同期処理は一瞬で完了することが多いため、無くてもあまり気になりません。
処理にかかる時間によって最適なUIも異なるため、本番環境での処理時間を考慮する必要があります。

### 失敗 (Error)

失敗とは、Query/Mutationが失敗したことを表す状態です。

### 成功 (Success)

成功とは、Query/Mutationが成功したことを表す状態です。

### 該当データなし (Empty)

該当データなしとは、Queryが取得したデータが空であることを表す状態です。

## さいごに

## 参考資料

- [つながる世界のソフトウェア品質ガイド](https://www.ipa.go.jp/archive/publish/qv6pgp0000000wkj-att/000055008.pdf)
- [プログレスインジケータの役割とは？デザイナーのためのインジケータ設計アイデア](https://goodpatch.com/blog/progress-indicator)
